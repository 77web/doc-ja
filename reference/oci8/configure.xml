<?xml version="1.0" encoding="utf-8" ?>
<!-- $Revision$ -->
<!-- EN-Revision: 5fcbcd6b56477034278a2199a8819635f3a0d9b9 Maintainer: satoruyoshida Status: working -->
<!-- CREDITS: hirokawa, shimooka, mumumu -->
<section xml:id="oci8.installation">
 &reftitle.install;


<section xml:id="oci8.configure" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>OCI8 とともに PHP を構成</title>
 <para>
  OCI8 を構成する前に前述の <link linkend="oci8.requirements">要件</link> 節に
  目を通してください。 
 </para>
 <para>
  OCI8 エクステンションを有効にするには、オプション
  <option role="configure">--with-oci8</option>
  とともに PHP を構成します。
 </para>
 <para>
  Web サーバーを開始する前に、一般的に OCI8 はいくつかの Oracle 環境変数（下記参照）を
  必要とします。それらはライブラリの場所を指定したり、構成ファイルを指示したり、
  Oracle ライブラリで使用する文字セットのような基本的ないくつかのプロパティを設定します。
  あらゆる PHP プロセスが開始される <emphasis>前に</emphasis>それらの変数を設定しなければいけません。
 </para>
 <para>
  PHP を構成したのと同じか、またはより最新の Oracle ライブラリのメジャー・バージョンとともに PHP バイナリをリンクしなければいけません。
  例えば Oracle 19 ライブラリで OCI8 をビルドするなら、
  PHP も Oracle 19 ライブラリとともにデプロイして実行すべきです。
  PHP のアプリケーションは、それ以外のバージョンの Oracle データベースにも接続できます。
  Oracle のクライアントとサーバーの間には、異なるバージョン間での互換性があるからです。
 </para>
</section>
<section>
 <title>OCI8 を PECL からインストール</title>
 <para xmlns:xlink="http://www.w3.org/1999/xlink">
  OCI8 拡張機能は、
  <link xlink:href="&url.pecl.package;oci8">PECL</link> を使えば
  既存の PHP のインストールに追加できます。
 </para>
 <para>
  以下の手順で、自動インストールを行えます
 </para>
 <para>
  <itemizedlist>
   <listitem>
    <para>
     ファイアウォールの後ろにいる場合、以下のようにしてプロキシを設定します:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
pear config-set http_proxy http://my-proxy.example.com:80/
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
   <listitem>
    <para>
     Run
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
pecl install oci8
]]>
      </screen>
     </informalexample>
    </para>
    <para>
     PHP 7 以降では、<literal>pecl install oci8-2.2.0</literal> とします。
    </para>
    <!-- to be translated -->
    <para>
     When prompted, enter either the value of <literal>$ORACLE_HOME</literal>, or
     <literal>instantclient,/path/to/instant/client/lib</literal>.
    </para>
    <para>
     Note: Do not enter the text <literal>$ORACLE_HOME</literal>
     because it will not be expanded.  Instead, enter the actual path
     of the Oracle home directory.
    </para>
   </listitem>
  </itemizedlist>
 </para>
 <para>
  For a manual install when the <literal>pecl</literal> command is not
  available, download the PECL OCI8 package, e.g. <filename>oci8-3.0.0.tgz</filename>.
 </para>
 <para>
  <itemizedlist>
   <listitem>
    <para>
     パッケージを展開します:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
tar -zxf oci8-3.0.0.tgz
cd oci8-3.0.0
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
   <listitem>
    <para>
     パッケージを準備します:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
phpize
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>$ORACLE_HOME</literal> または
     Instant Client を使ってパッケージを設定します。
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure -with-oci8=shared,$ORACLE_HOME
]]>
      </screen>
     </informalexample>
    </para>
    <para>
      または
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure -with-oci8=shared,instantclient,/path/to/instant/client/lib
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
   <listitem>
    <para>
     パッケージをインストールします:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
make install
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
  </itemizedlist>
 </para>
 <para>
  After either an automatic or manual install, edit your &php.ini;
  file and add the line:
 </para>
 <para>
  <informalexample>
   <screen>
<![CDATA[
extension=oci8.so
]]>
   </screen>
  </informalexample>
 </para>
 <para>
  Make sure the &php.ini;
  directive <link linkend="ini.extension-dir">extension_dir</link> is
  set to the directory that <filename>oci8.so</filename> was installed
  in.
 </para>
</section>
<section>
 <title>Installing OCI8 as a Shared Extension</title>
 <para>
  If you are building PHP from source code, the
  configuration <literal>shared</literal> option can be used to build OCI8 as a shared library
  that can be dynamically loaded into PHP.  Building a shared extension allows
  OCI8 to be upgraded easily without impacting the rest of PHP.
 </para>
 <para>
  Configure OCI8 using one of the following configure options.
 </para>
 <para>
  <itemizedlist>
   <listitem>
    <para>
     If using the free <link xmlns="http://docbook.org/ns/docbook"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     xlink:href="&url.oracle.instant.client;">Oracle Instant
     Client</link> libraries, then do:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure --with-oci8=shared,instantclient,/path/to/instant/client/lib
]]>
      </screen>
     </informalexample>
    </para>
    <para>
     If Instant Client 12.2 (or earlier) is installed from ZIP files, make sure to create
     the library symbolic link first, for example <literal>ln -s
     libclntsh.so.12.1 libclntsh.so</literal>.
    </para>
    <para>
     If using an RPM-based installation of Oracle Instant Client, the
     configure line will look like this:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure --with-oci8=shared,instantclient,/usr/lib/oracle/<version>/client/lib
]]>
      </screen>
     </informalexample>
    </para>
    <para>
     For example, <option role="configure">--with-oci8=shared,instantclient,/usr/lib/oracle/19.9/client/lib</option>
    </para>
    <para>
     Note that Oracle Instant Client support first appeared in PHP
     4.3.11 and 5.0.4 and originally used the option
     <option role="configure">--with-oci8-instant-client</option> to
     configure PHP.
    </para>
   </listitem>
   <listitem>
    <para>
     If using an Oracle database or full Oracle Client installation then do:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure --with-oci8=shared,$ORACLE_HOME
]]>
      </screen>
     </informalexample>
    </para>
    <para>
     Make sure the web server user
     (<literal>nobody</literal>, <literal>www</literal>) has access to
     the libraries, initialization files
     and <filename>tnsnames.ora</filename> (if used) under
     the <literal>$ORACLE_HOME</literal> directory.  With Oracle
     10<emphasis>g</emphasis>R2, you may need to run
     the <filename>$ORACLE_HOME/install/changePerm.sh</filename>
     utility to give directory access.
    </para>
   </listitem>
  </itemizedlist>
 </para>
 <para>
  After configuration, follow the usual PHP building procedure,
  e.g. <emphasis>make install</emphasis>.  The OCI8 shared extension
  <filename>oci8.so</filename> library will be created.  It may need
  to be manually moved to the PHP extension directory, specified by
  the <link linkend="ini.extension-dir">extension_dir</link> option in
  your &php.ini; file.
 </para>
 <para>
  To complete installation of OCI8, edit &php.ini; and add the line:
 </para>
 <para>
  <informalexample>
   <screen>
<![CDATA[
extension=oci8.so
]]>
   </screen>
  </informalexample>
 </para>
</section>
<section>
 <title>Installing OCI8 as a Statically Compiled Extension</title>
 <para>
  If you are building PHP from source code, you can configure PHP to include
  OCI8 as a static extension using one of the following configure options.
 </para>
 <para>
  <itemizedlist>
   <listitem>
    <para>
     If using Oracle Instant Client, then do:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure --with-oci8=instantclient,/path/to/instant/client/lib
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
   <listitem>
    <para>
     If using an Oracle database or full Oracle Client installation then do:
    </para>
    <para>
     <informalexample>
      <screen>
<![CDATA[
./configure --with-oci8=$ORACLE_HOME
]]>
      </screen>
     </informalexample>
    </para>
   </listitem>
  </itemizedlist>
 </para>
 <para>
  After configuration, follow the usual PHP building procedure,
  e.g. <emphasis>make install</emphasis>.  After successful
  compilation, you do not need to add <filename>oci8.so</filename> to
  &php.ini;.  No additional build steps are required.
 </para>
</section>
<section>
 <title>Windows で OCI8 をインストール</title>
 <para>
  With Oracle 12<emphasis>c</emphasis> (or later) libraries, uncomment one of
  the &php.ini; lines <literal>extension=php_oci8_12c.dll</literal>
  or <literal>extension=php_oci8_11g.dll</literal>
  or <literal>extension=php_oci8.dll</literal>. Only one of these DLLs may be
  enabled at a time. DLLs with higher versions may contain more
  functionality. Not all DLLs may be available for all versions of PHP.  Make
  sure <link linkend="ini.extension-dir">extension_dir</link> is set to the
  directory containing the PHP extension DLLs.
 </para>
 <para>
  もし Instant Client を使用する場合、システムの <envar>PATH</envar>
  環境変数を Oracle ライブラリ・ディレクトリに設定します。
 </para>
</section>
<section>
 <title>Oracle 環境を設定</title>
 <para>
  このエクステンションを使用する前に、 Web デーモンのユーザーのために Oracle の環境変数が
  適切に設定されたか確認してください。
  もし Web サーバーがブート時に自動起動される場合は、ブート時の環境も正しく設定されていることを
  確認してください。
 </para>
 <note>
  <para>
   PHP スクリプトで <function>putenv</function> を使って Oracle の環境変数を
   設定しないでください。それは、スクリプトが実行される前に Oracle のライブラリがロードされて
   初期化されるかもしれないからです。
   <function>putenv</function> で変数を設定すると、コンフリクト、クラッシュ、
   または予測出来ない動作の原因となるかもしれません。
   ある関数は動作し、他の関数は捉えがたいエラーを示すかもしれません。
   Web サーバー開始<emphasis>前</emphasis>に変数を設定するべきです。
  </para>
 </note>
 <para>
  Red Hat Linux と変種では、 <filename>/etc/sysconfig/httpd</filename>
  の最後で変数を export してください。 Apache 2 を伴う他のシステムでは
  Apache <filename>bin</filename> ディレクトリーで <filename>envvars</filename>
  スクリプトを使用するかもしれません。 ３番目のオプション、 <filename>httpd.conf</filename>
  の Apache <literal>SetEnv</literal> ディレクティブは、一部のシステムでは
  動作するかもしれませんが、他のシステムでは不適切であることが知られています。
 </para>
 <para>
  環境変数が正しく設定されたかチェックするには、 <function>phpinfo</function> を使って
  <emphasis>Environment</emphasis> セクション (<emphasis>Apache Environment</emphasis>
  ではありません) に期待される変数が含まれるかどうかチェックしてください。
 </para>
 <para>
  必要かもしれない変数が下記の表に含まれます。
  どんな変数が使えるのかについての詳細は Oracle ドキュメントを参照してください。
  <table>
   <title>一般的な Oracle 環境変数</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>名前</entry>
      <entry>目的</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>ORACLE_HOME</entry>
      <entry>フルの Oracle データベース・ソフトウェアのディレクトリを含みます。
      Oracle Instant Client を使用する際は、これを設定しないでください。
      設定することは余計なことで、インストール時に問題を引き起こすかもしれませんので。
      </entry>
     </row>
     <row>
      <entry>ORACLE_SID</entry>
      <entry>ローカルマシン上の、接続されるデータベース名を含みます。
      Oracle Instant Client を使用するか、または <function>oci_connect</function>
      に常に接続パラメータを渡す場合は、この設定は不要です。
      </entry>
     </row>
     <row>
      <entry>LD_LIBRARY_PATH</entry>
      <entry>Set this (or its platform equivalent, such
      as <literal>LIBPATH</literal>, or <literal>SHLIB_PATH</literal>) to the
      location of the Oracle libraries, for
      example <filename>$ORACLE_HOME/lib</filename>
      or <filename>/usr/lib/oracle/18.5/client/lib</filename>. Note with Instant
      Client 19 ZIP files on Linux it is more reliable to
      use <filename>ldconfig</filename> instead, see the Instant Client
      installation instructions.  With Instant Client 19 (or later) RPM
      files, <literal>ldconfig</literal> is automatically run for you.  Some
      users use
      <literal>LD_PRELOAD</literal> instead
      of <literal>LD_LIBRARY_PATH</literal>.</entry>
     </row>
     <row>
      <entry>NLS_LANG</entry>
      <entry>これは Oracle ライブラリで使用される文字セットや
      国際化情報を設定するためのプライマリ変数です。</entry>
     </row>
     <row>
      <entry>ORA_SDTZ</entry>
      <entry>Oracle セッションのタイムゾーンを設定します。</entry>
     </row>
     <row>
      <entry>TNS_ADMIN</entry>
      <entry>Contains the directory where the Oracle Net Services configuration
      files such as <filename>tnsnames.ora</filename>
      and <filename>sqlnet.ora</filename> are kept.  Not needed if
      the <function>oci_connect</function> connection string uses the Easy
      Connect naming syntax such as <literal>localhost/XE</literal>.  Not needed
      if the network configuration files are in one of the default locations
      such
      as <filename>/usr/lib/oracle/VERSION/client/lib/network/admin</filename>, <filename>$ORACLE_HOME/network/admin</filename>
      or <filename>/etc</filename>.
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>
   頻度は高くありませんが、
   <literal>TWO_TASK</literal> 、 <literal>ORA_TZFILE</literal> 、及び
   <literal>NLS*</literal> や <literal>ORA_NLS_*</literal> 変数のような
   様々な Oracle 国際化設定値を含む Oracle 環境変数が使用されます。
 </para>
</section>
<section>
 <title>トラブルシューティング</title>
 <para>
  OCI8 をインストールする際に最も一般的な問題は、 Oracle 環境が
  正しく設定されないことです。通常、これは <function>oci_connect</function>
  や <function>oci_pconnect</function> 使用上の問題として現れます。
  このエラーは <emphasis>Call to undefined function oci_connect()</emphasis>
  のような PHP エラーや、 ORA-12705 のような Oracle エラー、さらには
  Apache のクラッシュになるかもしれません。
  この問題を解決するために、起動時のエラーについて Apache のログファイルをチェックして、
  上記のセクションをご覧下さい。
 </para>
 <para>
  ORA-12154 または ORA-12514 のようなネットワークエラーは
  Oracle のネットワーク・ネーミングまたは構成の問題を示唆する反面、
  根本の原因は、 PHP 環境が誤って設定されたことや、 Oracle ライブラリが
  <filename>tnsnames.ora</filename> 構成ファイルの場所を指定できないためかもしれません。
 </para>
 <para>
  Windows では、一つのマシン上に Oracle の複数のバージョンを持つと、
  PHP が Oracle の正しいバージョンだけを使用することを確認するために注意を払わない限り、
  すぐにライブラリのクラッシュを引き起こします。
 </para>
 <para>
  特に Windows 上では、どのライブラリが検索されてロードされるか調べるユーティリティは、
  欠けていたりクラッシュしているライブラリの問題の解決に役立ちます。
 </para>
 <note>
  <title>Web サーバーが開始しないか、または起動時にクラッシュする場合</title>
  <para>
   Apache が pthread ライブラリとリンクされていることをチェックします。
  </para>
  <para>
   <informalexample>
    <screen>
<![CDATA[
# ldd /www/apache/bin/httpd
  libpthread.so.0 => /lib/libpthread.so.0 (0x4001c000)
  libm.so.6 => /lib/libm.so.6 (0x4002f000)
  libcrypt.so.1 => /lib/libcrypt.so.1 (0x4004c000)
  libdl.so.2 => /lib/libdl.so.2 (0x4007a000)
  libc.so.6 => /lib/libc.so.6 (0x4007e000)
  /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)
]]>
    </screen>
   </informalexample>
  </para>
  <para>
   libpthread が一覧に表示されなければ、 Apache を再インストールします。
  </para>
  <para>
   <informalexample>
    <screen>
<![CDATA[
# cd /usr/src/apache_1.3.xx
# make clean
# LIBS=-lpthread ./config.status
# make
# make install
]]>
    </screen>
   </informalexample>
  </para>
  <para>
   UnixWare のような一部のシステムでは、それは
   libpthread の代わりに libthread であることに注意してください。
   PHP 及び Apache を EXTRA_LIBS=-lthread とともに構成しなければいけません。
  </para>
 </note>
</section>


</section> <!-- oci8.installation -->
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

